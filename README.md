# 高速缓存仿真测试

该项目用以批量生成高速缓存随机地址访存数据，并将随机访问数据写入Vivado支持的Testbench文件中，以便进行高速缓存仿真测试。

## 信号规范

本项目的testbench要求待测模块的输入输出端口名称符合以下规范：

* 待测模块需要将两个高速缓存、主存封装为一个模块，并命名为`Cache_Top`。
* `Cache_Top`模块的输入输出端口名称需要符合以下规范：

| 端口名称 | 位宽 | 性质 | 说明 |
| :---: | :---: | :---: | :---: |
| clk | 1 | 输入 | 时钟信号 |
| rstn | 1 | 输入 | 复位信号 |
| i_addr | 32 | 输入 | icache访问地址 |
| i_rvalid | 1 | 输入 | icache读使能信号 |
| i_cache_miss | 1 | 输出 | icache缺失信号 |
| i_rdata | 32 | 输出 | icache读取数据 |
| i_commit | 1 | 输出| icache提交信号 |
| d_addr | 32 | 输入 | dcache访问地址 |
| d_mem_type | 5 | 输入 | dcache访存类型，详情见下方 |
| d_wdata | 32 | 输入 | dcache写入数据 |
| d_rdata | 32 | 输出 | dcache读取数据 |
| d_commit | 1 | 输出 | dcache提交信号 |

`d_mem_type`各个位的意义：

* 第[1:0]位：读写长度，00为字节，01为半字，10为字
* 第[2]位：是否为无符号拓展读，0为有符号拓展读，1为无符号拓展读
* 第[4:3]位：读写类型，01为读，10为写

## 对比原理

本项目支持对比两个高速缓存的仿真结果：

* 当commit信号被置位时，仿真会将rdata的值和模拟内存中的值进行对比，若不一致则会将error_reg置位，并不再向cache发送新请求
* 当所有请求完成后，pass_reg会被置位，表示仿真通过

## 使用方法

在本项目根目录下运行：
    
```shell
python3 gen_cache_tb.py 4096 8192
```

其中4096是内存总字数，8192是测试数据总数，可以自行修改。

这条命令将会在build文件夹下生成主存的coe初始化文件和高速缓存测试文件。

## 注意事项

* 本测试文件不接入ICache或DCache也可以正常运行，但是需要保证Cache_Top模块的输入输出端口名称符合规范（如不介入DCache，那么只需要在Cache_Top模块中将所有DCache相关的输出端口接0即可）。
